name: Playwright Tests
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with:
        node-version: 18
        
    - name: Install dependencies
      run: npm install  # Use npm install instead of npm ci
        
    - name: Install Playwright
      run: |
        npx playwright install chromium  # Install only Chrome (faster)
        
    - name: Run basic test
      run: |
        # Create a simple test if none exists
        if [ ! -f tests/simple.spec.js ]; then
          mkdir -p tests
          echo "import { test, expect } from '@playwright/test';

test('basic test', async ({ page }) => {
  await page.goto('https://example.com');
  const title = await page.title();
  console.log('Title:', title);
  expect(title).toContain('Example');
});" > tests/simple.spec.js
        fi
        
        # Run tests with single worker
        npx playwright test --workers=1 --timeout=30000
